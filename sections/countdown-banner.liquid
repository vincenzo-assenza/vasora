{%- assign eyebrow_tag = section.settings.eyebrow_tag | default: 'p' -%}
{%- assign heading_tag = section.settings.heading_tag | default: 'h2' -%}
{%- assign subheading_tag = section.settings.subheading_tag | default: 'p' -%}
{%- assign content_alignment = section.settings.content_alignment | default: 'center' -%}
{%- assign overlay_opacity = section.settings.overlay_opacity | default: 35 | divided_by: 100.0 -%}
{%- assign media_mode = section.settings.media_mode | default: 'auto' -%}
{%- assign allow_video = true -%}
{%- if media_mode == 'image_only' -%}
  {%- assign allow_video = false -%}
{%- endif -%}
{%- assign mobile_min_height = section.settings.mobile_min_height | default: 70 -%}
{%- assign mobile_min_height_unit = 'vh' -%}
{%- if mobile_min_height > 100 -%}
  {%- assign mobile_min_height_unit = 'px' -%}
{%- endif -%}
<section
  class="countdown-banner countdown-banner--align-{{ content_alignment }}"
  {% if section.settings.anchor_id != blank %}id="{{ section.settings.anchor_id | escape }}"{% endif %}
  style="
    --countdown-overlay-color: {{ section.settings.overlay_color | default: '#000000' }};
    --countdown-overlay-opacity: {{ overlay_opacity }};
    --countdown-mobile-min-height: {{ mobile_min_height }}{{ mobile_min_height_unit }};
    padding-top: {{ section.settings.padding_top | default: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | default: 0 }}px;
    margin-top: {{ section.settings.margin_top | default: 0 }}px;
    margin-bottom: {{ section.settings.margin_bottom | default: 0 }}px;
  "
>
  <div class="countdown-banner__media" aria-hidden="true">
    <div class="countdown-banner__media-item countdown-banner__media-item--desktop">
      {% if allow_video and section.settings.background_video_desktop != blank %}
        {{
          section.settings.background_video_desktop
          | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, image_size: '2000x'
        }}
      {% elsif section.settings.background_image != blank %}
        {{
          section.settings.background_image
          | image_url: width: 2000
          | image_tag: loading: 'lazy', widths: '800, 1200, 1600, 2000', alt: section.settings.heading
        }}
      {% else %}
        {{ 'image' | placeholder_svg_tag: 'placeholder' }}
      {% endif %}
    </div>

    <div class="countdown-banner__media-item countdown-banner__media-item--mobile">
      {% if allow_video and section.settings.background_video_mobile != blank %}
        {{
          section.settings.background_video_mobile
          | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, image_size: '1200x'
        }}
      {% elsif section.settings.background_image_mobile != blank %}
        {{
          section.settings.background_image_mobile
          | image_url: width: 1400
          | image_tag: loading: 'lazy', widths: '480, 750, 960, 1200, 1400', alt: section.settings.heading
        }}
      {% elsif section.settings.background_image != blank %}
        {{
          section.settings.background_image
          | image_url: width: 1400
          | image_tag: loading: 'lazy', widths: '480, 750, 960, 1200, 1400', alt: section.settings.heading
        }}
      {% else %}
        {{ 'image' | placeholder_svg_tag: 'placeholder' }}
      {% endif %}
    </div>
  </div>
  <div class="countdown-banner__overlay"></div>
  <div class="countdown-banner__inner">
    <div class="countdown-banner__content">
      {% if section.settings.eyebrow != blank %}
        <{{ eyebrow_tag }} class="countdown-banner__eyebrow">{{ section.settings.eyebrow }}</{{ eyebrow_tag }}>
      {% endif %}
      {% if section.settings.heading != blank %}
        <{{ heading_tag }} class="countdown-banner__heading">{{ section.settings.heading }}</{{ heading_tag }}>
      {% endif %}
      {% if section.settings.subheading != blank %}
        <{{ subheading_tag }} class="countdown-banner__subheading">{{ section.settings.subheading }}</{{ subheading_tag }}>
      {% endif %}
      {% if section.settings.cta_label != blank %}
        <a class="countdown-banner__cta" href="{{ section.settings.cta_link }}" title="{{ section.settings.cta_title | default: section.settings.cta_label | escape }}" aria-label="{{ section.settings.cta_title | default: section.settings.cta_label | escape }}">{{ section.settings.cta_label }}</a>
      {% endif %}
    </div>
    <div class="countdown-banner__timer" data-countdown data-end-date="{{ section.settings.end_date }}" data-end-time="{{ section.settings.end_time }}">
      <div class="countdown-banner__unit"><span data-days>00</span><small>DAY</small></div>
      <div class="countdown-banner__unit"><span data-hours>00</span><small>HRS</small></div>
      <div class="countdown-banner__unit"><span data-minutes>00</span><small>MIN</small></div>
      <div class="countdown-banner__unit"><span data-seconds>00</span><small>SEC</small></div>
    </div>
  </div>
</section>

{% stylesheet %}
  .countdown-banner {
    position: relative;
    min-height: clamp(320px, 60vh, 520px);
    color: #fff;
    overflow: hidden;
  }
  .countdown-banner__media {
    position: absolute;
    inset: 0;
  }
  .countdown-banner__media-item {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
  }
  .countdown-banner__media-item--mobile {
    display: none;
  }
  .countdown-banner__media img,
  .countdown-banner__media video,
  .countdown-banner__media svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .countdown-banner__overlay {
    position: absolute;
    inset: 0;
    background: var(--countdown-overlay-color, #000000);
    opacity: var(--countdown-overlay-opacity, 0.35);
  }
  .countdown-banner__inner {
    position: relative;
    width: min(100% - 2 * var(--container-padding-inline), var(--container-max));
    margin: 0 auto;
    min-height: inherit;
    display: grid;
    grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
    align-items: center;
    gap: var(--space-6);
    padding-block: 0;
  }
  .countdown-banner__content {
    text-align: center;
  }
  .countdown-banner__eyebrow {
    display: block;
    text-transform: uppercase;
    letter-spacing: 0.22em;
    font-size: 0.7rem;
    margin-bottom: var(--space-2);
  }
  .countdown-banner__heading {
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: clamp(1.8rem, 4vw, 3rem);
    margin: 0 0 var(--space-3);
  }
  .countdown-banner__subheading {
    color: rgba(255,255,255,0.85);
    max-width: 520px;
    margin-inline: auto;
  }
  .countdown-banner__cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-top: var(--space-4);
    padding: 0.6rem 1.4rem;
    background: #fff;
    color: #111;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.72rem;
    text-decoration: none;
  }
  .countdown-banner__timer {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: var(--space-4);
    text-align: center;
    justify-self: center;
    width: min(100%, 460px);
  }
  .countdown-banner--align-left .countdown-banner__content {
    text-align: left;
  }
  .countdown-banner--align-left .countdown-banner__subheading {
    margin-inline: 0;
  }
  .countdown-banner--align-left .countdown-banner__timer {
    justify-self: start;
  }
  .countdown-banner--align-right .countdown-banner__content {
    text-align: right;
  }
  .countdown-banner--align-right .countdown-banner__subheading {
    margin-inline: auto 0;
  }
  .countdown-banner--align-right .countdown-banner__timer {
    justify-self: end;
  }
  .countdown-banner__unit span {
    font-size: clamp(1.4rem, 3vw, 2.4rem);
    letter-spacing: 0.08em;
  }
  .countdown-banner__unit small {
    display: block;
    margin-top: 0.35rem;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-size: 0.6rem;
  }

  @media (max-width: 900px) {
    .countdown-banner {
      min-height: var(--countdown-mobile-min-height, 70vh);
    }
    .countdown-banner__media-item--desktop {
      display: none;
    }
    .countdown-banner__media-item--mobile {
      display: block;
    }
    .countdown-banner__inner {
      grid-template-columns: 1fr;
    }
    .countdown-banner__timer {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      width: min(100%, 320px);
    }
    .countdown-banner--align-left .countdown-banner__timer {
      justify-self: start;
    }
    .countdown-banner--align-center .countdown-banner__timer {
      justify-self: center;
    }
    .countdown-banner--align-right .countdown-banner__timer {
      justify-self: end;
    }
  }
{% endstylesheet %}

<script>
  (function() {
    const sectionEl = document.getElementById('shopify-section-{{ section.id }}');
    const countdown = sectionEl?.querySelector('[data-countdown]');
    if (countdown) {
      const endDate = countdown.dataset.endDate;
      const endTime = countdown.dataset.endTime || '00:00';
      let target = null;
      if (endDate) {
        let datePart = endDate;
        let timePart = endTime;
        if (endDate.includes(' ')) {
          const parts = endDate.split(' ');
          datePart = parts[0];
          timePart = parts[1] || endTime;
        }
        const [y, m, d] = datePart.split('-').map(Number);
        const [hh, mm] = (timePart || '00:00').split(':').map(Number);
        target = Date.UTC(y, (m || 1) - 1, d || 1, hh || 0, mm || 0, 0);
      }
      const els = {
        days: countdown.querySelector('[data-days]'),
        hours: countdown.querySelector('[data-hours]'),
        minutes: countdown.querySelector('[data-minutes]'),
        seconds: countdown.querySelector('[data-seconds]')
      };
      const update = () => {
        if (!target || Number.isNaN(target)) return;
        const now = Date.now();
        const diff = Math.max(0, target - now);
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        els.days.textContent = String(d).padStart(2, '0');
        els.hours.textContent = String(h).padStart(2, '0');
        els.minutes.textContent = String(m).padStart(2, '0');
        els.seconds.textContent = String(s).padStart(2, '0');
      };
      update();
      setInterval(update, 1000);
    }
  })();
</script>

{% schema %}
{
  "name": "Countdown banner",
  "settings": [
    {"type": "header", "content": "Content"},
    {"type": "text", "id": "anchor_id", "label": "Anchor ID", "default": "countdown"},
    {"type": "text", "id": "eyebrow", "label": "Eyebrow", "default": "Limited time only"},
    {"type": "text", "id": "heading", "label": "Heading", "default": "Super sale up to 40% off"},
    {"type": "text", "id": "subheading", "label": "Subheading", "default": "Shop our selection of exclusive handbags and backpacks at reduced price during the Super Sale. Hurry up!"},
    {"type": "text", "id": "cta_label", "label": "CTA label", "default": "Shop now"},
    {"type": "url", "id": "cta_link", "label": "CTA link"},

    {"type": "header", "content": "Accessibility"},
    {
      "type": "select",
      "id": "eyebrow_tag",
      "label": "Eyebrow tag",
      "default": "p",
      "options": [
        { "value": "h1", "label": "h1" },
        { "value": "h2", "label": "h2" },
        { "value": "h3", "label": "h3" },
        { "value": "h4", "label": "h4" },
        { "value": "h5", "label": "h5" },
        { "value": "h6", "label": "h6" },
        { "value": "p", "label": "p" },
        { "value": "span", "label": "span" },
        { "value": "div", "label": "div" }
      ]
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Heading tag",
      "default": "h2",
      "options": [
        { "value": "h1", "label": "h1" },
        { "value": "h2", "label": "h2" },
        { "value": "h3", "label": "h3" },
        { "value": "h4", "label": "h4" },
        { "value": "h5", "label": "h5" },
        { "value": "h6", "label": "h6" },
        { "value": "p", "label": "p" },
        { "value": "span", "label": "span" },
        { "value": "div", "label": "div" }
      ]
    },
    {
      "type": "select",
      "id": "subheading_tag",
      "label": "Subheading tag",
      "default": "p",
      "options": [
        { "value": "h1", "label": "h1" },
        { "value": "h2", "label": "h2" },
        { "value": "h3", "label": "h3" },
        { "value": "h4", "label": "h4" },
        { "value": "h5", "label": "h5" },
        { "value": "h6", "label": "h6" },
        { "value": "p", "label": "p" },
        { "value": "span", "label": "span" },
        { "value": "div", "label": "div" }
      ]
    },
    {"type": "text", "id": "cta_title", "label": "CTA a11y title"},

    {"type": "header", "content": "Media & Branding"},
    {
      "type": "select",
      "id": "media_mode",
      "label": "Media mode",
      "default": "auto",
      "options": [
        { "value": "auto", "label": "Auto (prefer video)" },
        { "value": "image_only", "label": "Image only" },
        { "value": "video_preferred", "label": "Video preferred" }
      ]
    },
    {"type": "image_picker", "id": "background_image", "label": "Background image"},
    {"type": "image_picker", "id": "background_image_mobile", "label": "Background image (mobile)"},
    {"type": "video", "id": "background_video_desktop", "label": "Background video (desktop)"},
    {"type": "video", "id": "background_video_mobile", "label": "Background video (mobile)"},
    {"type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000"},
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 35,
      "unit": "%"
    },

    {"type": "header", "content": "Layout"},
    {
      "type": "select",
      "id": "content_alignment",
      "label": "Content alignment",
      "default": "center",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "mobile_min_height",
      "label": "Mobile min height",
      "min": 50,
      "max": 100,
      "step": 5,
      "unit": "vh",
      "default": 70
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 80
    },
    {
      "type": "range",
      "id": "margin_top",
      "label": "Margin top",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "label": "Margin bottom",
      "min": 0,
      "max": 240,
      "step": 4,
      "default": 0
    },

    {"type": "header", "content": "Countdown"},
    {"type": "text", "id": "end_date", "label": "End date (YYYY-MM-DD)", "default": "2026-12-31"},
    {"type": "text", "id": "end_time", "label": "End time (HH:MM)", "default": "23:59"}
  ],
  "presets": [
    {"name": "Countdown banner", "category": "Aurum"}
  ]
}
{% endschema %}
